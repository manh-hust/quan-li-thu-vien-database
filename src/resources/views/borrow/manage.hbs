<div class="container container-manage-borrow" data-state="{{state}}">
    <h1 class="mt-3 mb-3">Quản lí mượn trả</h1>
    <div class="btn-group">
        <a href="/borrow/borrow-manage/W" class="btn btn-outline-success" data-state="W">Yêu cầu mượn</a>
        <a href="/borrow/borrow-manage/B" class="btn btn-outline-success" data-state="B">Đang mượn</a>
        <a href="/borrow/borrow-manage/O" class="btn btn-outline-success" data-state="O">Quá hạn</a>
    </div>

    <table class="table table-dark table-striped">
        <thead>
            <tr>
            <th scope="col">#</th>
            <th scope="col">Tên người dùng</th>
            <th scope="col">Sách muốn mượn</th>
            <th scope="col">Ngày mượn</th>
            <th scope="col">Hạn trả dự kiến</th>
            <th scope="col">Số lượng còn lại</th>
            <th scope="col">Số ngày còn</th>
            <th scope="col">Số số ngày trễ</th>
            <th colspan="4">Xác nhận</th>
            </tr>
        </thead>
        <tbody>
            {{#each data}}
            <tr>
                <th scope="row">{{sum @index 1}}</th>
                <td>{{this.user_name}}</td>
                <td>{{this.title_name}}</td>
                <td>{{this.borrow_date}}</td>
                <td>{{this.return_date}}</td>
                <td>{{this.quan_in_lib}} </td>
                <td>{{this.remaining_days}}</td>
                <td>{{this.days_late}}</td>
                <td><button class="btn btn-success btn-confirm-borrow " data-borrowID="{{this.borrow_id}}"> Chấp nhận</button></td>
                <td><button class="btn btn-warning btn-remind-borrow" data-borrowID="{{this.borrow_id}}"> Nhắc nhở</button></td>
                <td><button class="btn btn-danger btn-warning-borrow" data-borrowID="{{this.borrow_id}}"> Cảnh báo</button></td>
            </tr>
            {{else}}
            <tr>
            <th scope="row"></th>
            <td> Không có dữ liệu !</td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            </tr>
            {{/each}}
        </tbody>
    </table>
</div>

<form method="POST"  id="form-confirm-borrow"></form>
{{!-- Submit confirm require --}}
<script>
    const form = $('#form-confirm-borrow')
    const btnConfirm = $('.btn-confirm-borrow')


    btnConfirm.each(function(i) {
        const borrowID = $(this).data('borrowid')
        $(this).on('click', function(){
                form.attr('action', `/borrow/borrow-manage/${state}/${borrowID}`)
                form.submit()
        })
    })
</script>


<script>
    const containerMB = $('.container-manage-borrow') 
    const state = containerMB.data('state')

    const  btnsConfirm  = $('.btn-confirm-borrow')
    const  btnsRemind  = $('.btn-remind-borrow')
    const  btnsWarning  = $('.btn-warning-borrow')
    btnsConfirm.hide()
    btnsRemind.hide()
    btnsWarning.hide()
    if(state == 'B'){
        btnsRemind.show()
    }
    else if(state == 'W'){
        btnsConfirm.show()
    }
    else if(state == 'O'){
        btnsWarning.show()
    }

    const btnGroupControl = $('.container-manage-borrow .btn-group a')


    btnGroupControl.each(function(i) {
        if($(this).data('state') == state){
            $(this).removeClass('btn-outline-success')
            $(this).addClass('btn-success')
        }
    })
    
</script>